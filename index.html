<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korean-English Code Mixing STS Leaderboard</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">

    <!-- LINEAR-inspired Clean Styles -->
    <link rel="stylesheet" href="./assets/linear-styles.css">

    <!-- Dataset Samples -->
    <script src="./assets/dataset-samples.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Page Header -->
        <header class="page-header">
            <h1 class="page-title">Korean-English Code Mixing STS Leaderboard</h1>
            <p class="page-description">
                Which embedding model performs best on Korean and Konglish text?
            </p>
            <p style="font-size: 0.875rem; color: var(--text-tertiary); margin-top: var(--space-2);" id="eval-date">
                Last evaluated: October 2, 2025
            </p>
        </header>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Models Evaluated</div>
                <div class="stat-value" id="stat-models">4</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg KOR-STS Score</div>
                <div class="stat-value" id="stat-kor-sts">0.905</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg CM-STS Score</div>
                <div class="stat-value" id="stat-cm-sts">0.886</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Dataset Size</div>
                <div class="stat-value">1,500</div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-item active" data-tab="leaderboard">Leaderboard</button>
            <button class="nav-item" data-tab="visualization">Visualization</button>
            <button class="nav-item" data-tab="dataset">Dataset & Examples</button>
            <button class="nav-item" data-tab="methodology">Methodology</button>
        </nav>

        <!-- Tab: Leaderboard -->
        <div class="tab-panel active" data-panel="leaderboard">
            <div class="table-container">
                <div class="table-header">
                    <h2 class="table-title">Performance Rankings</h2>
                    <div style="display: flex; gap: var(--space-3);">
                        <select id="sortSelect" class="btn">
                            <option value="cm_sts">Sort by CM-STS</option>
                            <option value="kor_sts">Sort by KOR-STS</option>
                            <option value="auc">Sort by Robustness</option>
                            <option value="latency">Sort by Latency</option>
                            <option value="cost">Sort by Cost</option>
                        </select>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 60px;">Rank</th>
                                <th>Model</th>
                                <th style="width: 100px;">Dimension</th>
                                <th style="width: 100px;">KOR-STS</th>
                                <th style="width: 100px;">CM-STS</th>
                                <th style="width: 100px;">AUC</th>
                                <th style="width: 100px;">Latency</th>
                                <th style="width: 100px;">Cost/1M</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                            <tr>
                                <td colspan="8" class="empty-state">
                                    <div class="empty-state-icon">‚è≥</div>
                                    <div>Loading data...</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Visualization -->
        <div class="tab-panel" data-panel="visualization">
            <!-- Chart Controls -->
            <div style="display: flex; gap: var(--space-4); margin-bottom: var(--space-6); flex-wrap: wrap;">
                <select id="bubbleSizeMetric" class="btn">
                    <option value="efficiency">Bubble Size: Efficiency</option>
                    <option value="cost">Bubble Size: Cost</option>
                    <option value="latency">Bubble Size: Latency</option>
                </select>
            </div>

            <!-- Bubble Chart -->
            <div class="card mb-8">
                <div class="card-header">
                    <h2 class="card-title">Performance Comparison</h2>
                    <p class="card-description">Korean STS vs Code-Mixed STS with efficiency and robustness ¬∑ Axes start at 0.85</p>
                </div>
                <div style="position: relative; height: 500px;">
                    <canvas id="bubbleChart"></canvas>
                </div>
                <div style="text-align: center; margin-top: var(--space-4); font-size: 0.875rem; color: var(--text-tertiary);">
                    X: Korean STS ‚Ä¢ Y: Code-Mixed STS ‚Ä¢ Size: Efficiency ‚Ä¢ Color: Provider
                </div>
            </div>

            <!-- Radar Charts Grid -->
            <h2 style="margin-bottom: var(--space-4);">Model Comparison Radar</h2>

            <!-- Normalization Info (Collapsible) -->
            <div class="card" style="background: var(--bg-secondary); margin-bottom: 12px;">
                <div style="cursor: pointer; user-select: none; padding: 12px 16px;" onclick="
                    const details = document.getElementById('normalization-details');
                    const arrow = document.getElementById('norm-arrow');
                    if (details.style.display === 'none') {
                        details.style.display = 'block';
                        arrow.textContent = '‚ñº';
                    } else {
                        details.style.display = 'none';
                        arrow.textContent = '‚ñ∂';
                    }
                ">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span id="norm-arrow" style="transition: all 0.2s; color: var(--text-tertiary); font-size: 0.75rem;">‚ñ∂</span>
                        <div style="flex: 1;">
                            <h3 style="font-size: 0.9375rem; font-weight: 600; margin: 0 0 4px 0; color: var(--text-primary);">Normalization Method</h3>
                            <p style="margin: 0; font-size: 0.8125rem; color: var(--text-secondary);">All metrics are normalized to 0-100 scale for easier comparison</p>
                        </div>
                    </div>
                </div>
                <div id="normalization-details" style="display: none; padding-top: var(--space-4);">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-6);">
                        <div style="padding: var(--space-4); background: var(--bg-primary); border-radius: var(--radius-md); border: 1px solid var(--border-primary);">
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-3); font-size: 0.9375rem;">
                                Performance Metrics
                            </div>
                            <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                                <div>
                                    <div style="font-weight: 500; color: var(--text-primary); margin-bottom: var(--space-1); font-size: 0.875rem;">KOR-STS & CM-STS</div>
                                    <div style="color: var(--text-secondary); font-size: 0.8125rem;">Range: 0.70 - 1.00</div>
                                    <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-tertiary); margin-top: var(--space-1); background: var(--bg-tertiary); padding: var(--space-2); border-radius: var(--radius-sm);">
                                        score = (value - 0.70) / 0.30 √ó 100
                                    </div>
                                </div>
                                <div>
                                    <div style="font-weight: 500; color: var(--text-primary); margin-bottom: var(--space-1); font-size: 0.875rem;">Robustness (AUC)</div>
                                    <div style="color: var(--text-secondary); font-size: 0.8125rem;">Range: 0.95 - 1.00</div>
                                    <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-tertiary); margin-top: var(--space-1); background: var(--bg-tertiary); padding: var(--space-2); border-radius: var(--radius-sm);">
                                        score = (value - 0.95) / 0.05 √ó 100
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="padding: var(--space-4); background: var(--bg-primary); border-radius: var(--radius-md); border: 1px solid var(--border-primary);">
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-3); font-size: 0.9375rem;">
                                Efficiency Metrics
                            </div>
                            <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                                <div>
                                    <div style="font-weight: 500; color: var(--text-primary); margin-bottom: var(--space-1); font-size: 0.875rem;">Cost Efficiency</div>
                                    <div style="color: var(--text-secondary); font-size: 0.8125rem;">Range: $0.05 - $0.25 per 1M</div>
                                    <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-tertiary); margin-top: var(--space-1); background: var(--bg-tertiary); padding: var(--space-2); border-radius: var(--radius-sm);">
                                        score = (0.25 - price) / 0.20 √ó 100
                                    </div>
                                </div>
                                <div>
                                    <div style="font-weight: 500; color: var(--text-primary); margin-bottom: var(--space-1); font-size: 0.875rem;">Latency Efficiency</div>
                                    <div style="color: var(--text-secondary); font-size: 0.8125rem;">Range: 10 - 50 ms/text</div>
                                    <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-tertiary); margin-top: var(--space-1); background: var(--bg-tertiary); padding: var(--space-2); border-radius: var(--radius-sm);">
                                        score = (50 - latency) / 40 √ó 100
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Radar Charts 2x2 Grid -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-6); margin-bottom: var(--space-8);">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" id="radar-title-0">Model 1</h3>
                        <p class="card-description" id="radar-subtitle-0">5D Performance</p>
                    </div>
                    <div style="position: relative; height: 280px;">
                        <canvas id="radarChart0"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" id="radar-title-1">Model 2</h3>
                        <p class="card-description" id="radar-subtitle-1">5D Performance</p>
                    </div>
                    <div style="position: relative; height: 280px;">
                        <canvas id="radarChart1"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" id="radar-title-2">Model 3</h3>
                        <p class="card-description" id="radar-subtitle-2">5D Performance</p>
                    </div>
                    <div style="position: relative; height: 280px;">
                        <canvas id="radarChart2"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" id="radar-title-3">Model 4</h3>
                        <p class="card-description" id="radar-subtitle-3">5D Performance</p>
                    </div>
                    <div style="position: relative; height: 280px;">
                        <canvas id="radarChart3"></canvas>
                    </div>
                </div>
            </div>

            <!-- AUC Line Chart -->
            <div class="card mb-8">
                <div class="card-header">
                    <h2 class="card-title">Robustness Curve (AUC)</h2>
                    <p class="card-description">Performance retention across code-mixing levels ¬∑ Y-axis starts at 90%</p>
                    <div style="font-size: 0.8125rem; color: var(--text-tertiary); margin-top: var(--space-2); padding: var(--space-2); background: var(--bg-tertiary); border-radius: var(--radius-sm);">
                        AUC weighted = Œ£(retention<sub>k</sub> √ó weight<sub>k</sub>) where retention = 1 - normalized_gap, weighted by dataset distribution
                    </div>
                </div>
                <div style="position: relative; height: 400px;">
                    <canvas id="aucChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tab: Dataset & Examples -->
        <div class="tab-panel" data-panel="dataset">
            <!-- Dataset Stats -->
            <div class="stats-grid mb-8">
                <div class="stat-card">
                    <div class="stat-label">Total Samples</div>
                    <div class="stat-value">1,500</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Mixing Levels</div>
                    <div class="stat-value">4</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Similarity</div>
                    <div class="stat-value">0.786</div>
                    <div class="stat-change" style="font-size: 0.75rem; color: var(--text-tertiary);">gemini-embedding-001</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Standard Deviation</div>
                    <div class="stat-value">0.144</div>
                    <div class="stat-change" style="font-size: 0.75rem; color: var(--text-tertiary);">gemini-embedding-001</div>
                </div>
            </div>

            <!-- How Code-Mixing Works -->
            <div class="card mb-8">
                <div class="card-header">
                    <h2 class="card-title">How Code-Mixing Works</h2>
                    <p class="card-description">LLM-based systematic code-mixing preserving Korean grammar while replacing k words with natural English equivalents</p>
                </div>

                <!-- Process Overview -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-4); margin-bottom: var(--space-6); padding: var(--space-4); background: var(--bg-secondary); border-radius: var(--radius-md);">
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: var(--space-2);">üìù</div>
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-1); font-size: 0.9375rem;">1. Analyze</div>
                        <div style="font-size: 0.8125rem; color: var(--text-secondary);">Extract candidates using Kiwi morphological analyzer</div>
                        <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-tertiary); margin-top: var(--space-2);">NNG, MAJ, IC</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: var(--space-2);">ü§ñ</div>
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-1); font-size: 0.9375rem;">2. Mix</div>
                        <div style="font-size: 0.8125rem; color: var(--text-secondary);">LLM replaces 1-5 words/phrases with English</div>
                        <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-tertiary); margin-top: var(--space-2);">Gemini 2.5 Flash</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: var(--space-2);">‚úì</div>
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-1); font-size: 0.9375rem;">3. Validate</div>
                        <div style="font-size: 0.8125rem; color: var(--text-secondary);">Ensure bilingual & grammar preservation</div>
                        <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-tertiary); margin-top: var(--space-2);">Korean + English</div>
                    </div>
                </div>

                <!-- Key Rules -->
                <div style="margin-bottom: var(--space-6); padding: var(--space-4); border-left: 3px solid #4285f4; background: var(--bg-tertiary); border-radius: var(--radius-sm);">
                    <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-3); font-size: 0.9375rem;">‚úÖ Core Principles</div>
                    <div style="display: flex; flex-direction: column; gap: var(--space-2);">
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            <span style="color: var(--text-primary); font-weight: 500;">Grammar Preservation:</span> Korean word order, particles (ÏùÄ/Îäî, Ïù¥/Í∞Ä), and endings remain unchanged
                        </div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            <span style="color: var(--text-primary); font-weight: 500;">Natural Mixing:</span> Prioritize loanwords, brand names, and commonly mixed terms
                        </div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            <span style="color: var(--text-primary); font-weight: 500;">Primary POS:</span> Common nouns (NNG), conjunctive adverbs (MAJ), interjections (IC)
                        </div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            <span style="color: var(--text-primary); font-weight: 500;">Additional POS:</span> Proper nouns (NNP), general adverbs (MAG), nominalizations (VV/VA/VX+ETN)
                        </div>
                    </div>
                </div>

                <!-- Examples from actual data -->
                <div style="display: flex; flex-direction: column; gap: var(--space-5);">
                    <!-- Example 1: k=1 -->
                    <div>
                        <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                            <div style="flex: 1; height: 1px; background: var(--border-primary);"></div>
                            <span style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary);">k=1 (Light Mix)</span>
                            <div style="flex: 1; height: 1px; background: var(--border-primary);"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: var(--space-3); align-items: start;">
                            <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary); padding-top: var(--space-1);">Original</div>
                            <div class="sentence-text">ÏπúÏ†àÌïú <span style="background: #fef3c7; padding: 2px 4px; border-radius: 3px;">Ìò∏Ïä§Ìä∏</span>ÏôÄ Íπ®ÎÅóÌïú ÏàôÏÜåÍ∞Ä ÎÑàÎ¨¥ Ï¢ãÏïòÏñ¥Ïöî.</div>
                            <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary); padding-top: var(--space-1);">Mixed</div>
                            <div class="sentence-text">ÏπúÏ†àÌïú <span class="mixed-word">host</span>ÏôÄ Íπ®ÎÅóÌïú ÏàôÏÜåÍ∞Ä ÎÑàÎ¨¥ Ï¢ãÏïòÏñ¥Ïöî.</div>
                            <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary); padding-top: var(--space-1);">Rule</div>
                            <div style="font-size: 0.8125rem; color: var(--text-secondary);">
                                <span style="font-family: var(--font-mono); background: var(--bg-tertiary); padding: 2px 6px; border-radius: 3px;">Ìò∏Ïä§Ìä∏ ‚Üí host</span>
                                <span style="margin-left: var(--space-2);">Loanword replacement (NNG)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Example 2: k=2 -->
                    <div>
                        <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                            <div style="flex: 1; height: 1px; background: var(--border-primary);"></div>
                            <span style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary);">k=2 (Medium Mix)</span>
                            <div style="flex: 1; height: 1px; background: var(--border-primary);"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: var(--space-3); align-items: start;">
                            <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary); padding-top: var(--space-1);">Original</div>
                            <div class="sentence-text">Ïä¨Ìîà Í≤ÉÏùÄ <span style="background: #fef3c7; padding: 2px 4px; border-radius: 3px;">Ïó≠</span>ÏóêÏÑú Ï°∞Í∏à Î©ÄÍ∏∞ ÎïåÎ¨∏Ïóê <span style="background: #fef3c7; padding: 2px 4px; border-radius: 3px;">Î≤ÑÏä§</span>Î•º ÌÉÄÏïº ÌïúÎã§Îäî Í≤ÉÏûÖÎãàÎã§.</div>
                            <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary); padding-top: var(--space-1);">Mixed</div>
                            <div class="sentence-text">Ïä¨Ìîà Í≤ÉÏùÄ <span class="mixed-word">station</span>ÏóêÏÑú Ï°∞Í∏à Î©ÄÍ∏∞ ÎïåÎ¨∏Ïóê <span class="mixed-word">bus</span>Î•º ÌÉÄÏïº ÌïúÎã§Îäî Í≤ÉÏûÖÎãàÎã§.</div>
                            <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary); padding-top: var(--space-1);">Rule</div>
                            <div style="font-size: 0.8125rem; color: var(--text-secondary);">
                                <span style="font-family: var(--font-mono); background: var(--bg-tertiary); padding: 2px 6px; border-radius: 3px;">Ïó≠ ‚Üí station</span>
                                <span style="font-family: var(--font-mono); background: var(--bg-tertiary); padding: 2px 6px; border-radius: 3px; margin-left: var(--space-2);">Î≤ÑÏä§ ‚Üí bus</span>
                                <span style="margin-left: var(--space-2);">Korean particles (ÏóêÏÑú, Î•º) preserved</span>
                            </div>
                        </div>
                    </div>

                    <!-- Example 3: k=3 -->
                    <div>
                        <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                            <div style="flex: 1; height: 1px; background: var(--border-primary);"></div>
                            <span style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary);">k=3 (Heavy Mix)</span>
                            <div style="flex: 1; height: 1px; background: var(--border-primary);"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: var(--space-3); align-items: start;">
                            <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary); padding-top: var(--space-1);">Original</div>
                            <div class="sentence-text"><span style="background: #fef3c7; padding: 2px 4px; border-radius: 3px;">Î≥¥ÏùºÎü¨</span> Ï†êÍ≤ÄÏùÄ <span style="background: #fef3c7; padding: 2px 4px; border-radius: 3px;">Íµ¨Ïõî</span>ÎßêÍ≥† <span style="background: #fef3c7; padding: 2px 4px; border-radius: 3px;">ÏãúÏõî</span> Ï†ÑÏóê ÌïòÏûê.</div>
                            <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary); padding-top: var(--space-1);">Mixed</div>
                            <div class="sentence-text"><span class="mixed-word">boiler</span> Ï†êÍ≤ÄÏùÄ <span class="mixed-word">September</span> ÎßêÍ≥† <span class="mixed-word">October</span> Ï†ÑÏóê ÌïòÏûê.</div>
                            <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-tertiary); padding-top: var(--space-1);">Rule</div>
                            <div style="font-size: 0.8125rem; color: var(--text-secondary);">
                                <span style="font-family: var(--font-mono); background: var(--bg-tertiary); padding: 2px 6px; border-radius: 3px;">Î≥¥ÏùºÎü¨ ‚Üí boiler</span>
                                <span style="font-family: var(--font-mono); background: var(--bg-tertiary); padding: 2px 6px; border-radius: 3px; margin-left: var(--space-2);">Íµ¨Ïõî/ÏãúÏõî ‚Üí September/October</span>
                                <span style="margin-left: var(--space-2);">Multiple noun replacements</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dataset Samples -->
            <div class="mb-8">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-4);">
                    <h2>Dataset Samples</h2>
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div style="font-size: 0.875rem; color: var(--text-tertiary);">
                            Showing <span id="shownCount" style="color: var(--text-primary); font-weight: 600;">6</span>
                            of <span id="totalCount" style="color: var(--text-primary); font-weight: 600;">30</span>
                        </div>
                        <a href="dataset_detail.html" class="btn btn-secondary" style="font-size: 0.875rem; padding: 6px 12px;">
                            View Full Dataset ‚Üí
                        </a>
                    </div>
                </div>

                <!-- K explanation -->
                <div style="padding: var(--space-3) var(--space-4); background: var(--bg-tertiary); border-left: 3px solid #6366f1; border-radius: var(--radius-sm); margin-bottom: var(--space-6); font-size: 0.875rem; color: var(--text-secondary);">
                    <strong style="color: var(--text-primary);">k</strong> = number of replaced phrases (a phrase can be a single word or multiple consecutive words)
                </div>

                <!-- Controls -->
                <div class="controls">
                    <input type="search" id="searchInput" class="search-input" placeholder="Search samples...">
                    <div class="filter-group">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="k=1">k=1</button>
                        <button class="filter-btn" data-filter="k=2">k=2</button>
                        <button class="filter-btn" data-filter="k=3">k=3</button>
                        <button class="filter-btn" data-filter="k=4">k=4</button>
                    </div>
                </div>

                <!-- Samples Grid -->
                <div class="samples-grid" id="samplesGrid">
                    <!-- Samples will be inserted here -->
                </div>

                <!-- Load More -->
                <div class="load-more">
                    <button class="btn btn-primary" id="loadMoreBtn">
                        Load More Samples
                    </button>
                    <div class="load-more-info" id="loadMoreInfo"></div>
                </div>
            </div>
        </div>

        <!-- Tab: Methodology -->
        <div class="tab-panel" data-panel="methodology">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: var(--space-6);">
                <!-- Dataset Creation -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Dataset Creation</h3>
                        <p class="card-description">Based on KLUE-STS with systematic code-mixing</p>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                        <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--border-secondary);">
                            <span style="color: var(--text-tertiary); font-size: 0.875rem;">Base Dataset</span>
                            <span style="font-weight: 500;">KLUE-STS</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--border-secondary);">
                            <span style="color: var(--text-tertiary); font-size: 0.875rem;">Generator</span>
                            <span style="font-weight: 500;">Gemini 2.5 Flash</span>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: var(--space-1); padding: var(--space-2) 0;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-tertiary); font-size: 0.875rem;">Quality Threshold</span>
                                <span style="font-weight: 500;">‚â• 0.8 similarity</span>
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary); text-align: right;">
                                via gemini-embedding-001
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Code-Mixing Levels -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Code-Mixing Levels</h3>
                        <p class="card-description">Distribution by mixing intensity</p>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                        <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--border-secondary);">
                            <span style="color: var(--text-tertiary); font-size: 0.875rem;">k=1 (Light)</span>
                            <span style="font-weight: 500;">55% (825)</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--border-secondary);">
                            <span style="color: var(--text-tertiary); font-size: 0.875rem;">k=2 (Medium)</span>
                            <span style="font-weight: 500;">31.8% (477)</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--border-secondary);">
                            <span style="color: var(--text-tertiary); font-size: 0.875rem;">k=3 (Heavy)</span>
                            <span style="font-weight: 500;">11.1% (166)</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0;">
                            <span style="color: var(--text-tertiary); font-size: 0.875rem;">k=4+ (Very Heavy)</span>
                            <span style="font-weight: 500;">2.1% (32)</span>
                        </div>
                    </div>
                </div>

                <!-- Evaluation Metrics -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Evaluation Metrics</h3>
                        <p class="card-description">Multi-dimensional performance assessment</p>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                        <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--border-secondary);">
                            <span style="color: var(--text-tertiary); font-size: 0.875rem;">KOR-STS</span>
                            <span style="font-weight: 500;">Spearman œÅ</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--border-secondary);">
                            <span style="color: var(--text-tertiary); font-size: 0.875rem;">CM-STS</span>
                            <span style="font-weight: 500;">Spearman œÅ</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--border-secondary);">
                            <span style="color: var(--text-tertiary); font-size: 0.875rem;">Robustness</span>
                            <span style="font-weight: 500;">AUC weighted</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0;">
                            <span style="color: var(--text-tertiary); font-size: 0.875rem;">Efficiency</span>
                            <span style="font-weight: 500;">Latency & Cost</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('=== SCRIPT STARTED ===');

        // Embedded data (no fetch required)
        const LEADERBOARD_DATA = {
            "dataset_info": {
                "n_rows": 1500,
                "input_file": "ko-en-cm-gemini-2.5-flash-2509251640.jsonl",
                "evaluated_at": "2025-10-02 10:03:00",
                "mixed_k_distribution": {
                    "1": 825,
                    "2": 477,
                    "3": 166,
                    "4": 32
                },
                "mixed_k_percentages": {
                    "1": "55.0%",
                    "2": "31.8%",
                    "3": "11.1%",
                    "4": "2.1%"
                }
            },
            "results": [
                {
                    "provider": "openai",
                    "model": "text-embedding-3-large",
                    "output_dim": 3072,
                    "n_rows": 1500,
                    "mean_org": 0.6108901500701904,
                    "std_org": 0.2671308219432831,
                    "mean_cm": 0.5804539918899536,
                    "std_cm": 0.24512922763824463,
                    "mean_gap": 0.03043619729578495,
                    "p90_gap": 0.10335233062505722,
                    "p95_gap": 0.14747753739356995,
                    "p90_norm_gap": 0.05715227127075195,
                    "p95_norm_gap": 0.08025806397199631,
                    "spearman_org_vs_score": 0.9056153266539294,
                    "spearman_cm_vs_score": 0.8819203246033243,
                    "pearson_org_vs_score": 0.940489425465149,
                    "pearson_cm_vs_score": 0.9170914153229998,
                    "auc_uniform": 0.9773742722562677,
                    "auc_weighted": 0.9792813834021918,
                    "retention_by_k": {
                        "1": 0.9835555081069373,
                        "2": 0.9742910391260097,
                        "3": 0.9723816262284319,
                        "4": 0.9792689155636918
                    },
                    "delta_mae_p50": -0.007348358631134033,
                    "delta_mae_p90": 0.012530732899904251,
                    "delta_mae_p95": 0.021954646334052086,
                    "avg_latency_ms_per_text": 25.47926739996506,
                    "avg_latency_ms_per_1k_tokens": 748.6269117752015,
                    "total_time_sec": 114.65670329984277,
                    "total_tokens": 153156,
                    "price_per_1m_usd": 0.13,
                    "total_cost_usd": 0.01991028,
                    "total_cost_usd_str": "0.0199"
                },
                {
                    "provider": "google",
                    "model": "gemini-embedding-001",
                    "output_dim": 3072,
                    "n_rows": 1500,
                    "mean_org": 0.8065968155860901,
                    "std_org": 0.1558956801891327,
                    "mean_cm": 0.7863571047782898,
                    "std_cm": 0.14369650185108185,
                    "mean_gap": 0.020239630714058876,
                    "p90_gap": 0.05095897987484932,
                    "p95_gap": 0.06850267201662064,
                    "p90_norm_gap": 0.02659505419433117,
                    "p95_norm_gap": 0.0352100133895874,
                    "spearman_org_vs_score": 0.9145104388967632,
                    "spearman_cm_vs_score": 0.9024063594520016,
                    "pearson_org_vs_score": 0.9521496572569997,
                    "pearson_cm_vs_score": 0.9423555418804237,
                    "auc_uniform": 0.9870252304930369,
                    "auc_weighted": 0.9886220062869092,
                    "retention_by_k": {
                        "1": 0.9907514836015737,
                        "2": 0.986295867911524,
                        "3": 0.9852700911237238,
                        "4": 0.9857834793353262
                    },
                    "delta_mae_p50": -0.007191464304924011,
                    "delta_mae_p90": 0.0019523602677509189,
                    "delta_mae_p95": 0.004593211226165295,
                    "avg_latency_ms_per_text": 43.48177475557249,
                    "avg_latency_ms_per_1k_tokens": 2161.5039812654786,
                    "total_time_sec": 195.6679864000762,
                    "total_tokens": 90524,
                    "price_per_1m_usd": 0.15,
                    "total_cost_usd": 0.013578599999999998,
                    "total_cost_usd_str": "0.0136"
                },
                {
                    "provider": "voyage",
                    "model": "voyage-3-large",
                    "output_dim": 1024,
                    "n_rows": 1500,
                    "mean_org": 0.6892658472061157,
                    "std_org": 0.24294951558113098,
                    "mean_cm": 0.6668487787246704,
                    "std_cm": 0.2201329469680786,
                    "mean_gap": 0.0224170982837677,
                    "p90_gap": 0.07951802015304565,
                    "p95_gap": 0.1139901652932167,
                    "p90_norm_gap": 0.042391885071992874,
                    "p95_norm_gap": 0.0601312480866909,
                    "spearman_org_vs_score": 0.8929397912170579,
                    "spearman_cm_vs_score": 0.8774145690094177,
                    "pearson_org_vs_score": 0.9212025972209976,
                    "pearson_cm_vs_score": 0.9016036518319501,
                    "auc_uniform": 0.980672700643505,
                    "auc_weighted": 0.9837386364929612,
                    "retention_by_k": {
                        "1": 0.9865296878792122,
                        "2": 0.9804993687126841,
                        "3": 0.980907369341144,
                        "4": 0.9747543766409799
                    },
                    "delta_mae_p50": -0.007079720497131348,
                    "delta_mae_p90": 0.014170446433126926,
                    "delta_mae_p95": 0.02023226022720337,
                    "avg_latency_ms_per_text": 16.66129926677483,
                    "avg_latency_ms_per_1k_tokens": 688.7174402734329,
                    "total_time_sec": 74.97584670048673,
                    "total_tokens": 108863,
                    "price_per_1m_usd": 0.18,
                    "total_cost_usd": 0.01959534,
                    "total_cost_usd_str": "0.0196"
                },
                {
                    "provider": "upstage",
                    "model": "solar-embedding-1-large-passage",
                    "output_dim": 4096,
                    "n_rows": 1500,
                    "mean_org": 0.7014784216880798,
                    "std_org": 0.20888471603393555,
                    "mean_cm": 0.6552191376686096,
                    "std_cm": 0.1957240104675293,
                    "mean_gap": 0.046259284019470215,
                    "p90_gap": 0.10041298717260361,
                    "p95_gap": 0.12750189006328583,
                    "p90_norm_gap": 0.0560467466711998,
                    "p95_norm_gap": 0.06835753470659256,
                    "spearman_org_vs_score": 0.9065154832546988,
                    "spearman_cm_vs_score": 0.8839691495077721,
                    "pearson_org_vs_score": 0.9276255201086,
                    "pearson_cm_vs_score": 0.9076205695464988,
                    "auc_uniform": 0.9666724732662064,
                    "auc_weighted": 0.973158102561909,
                    "retention_by_k": {
                        "1": 0.9793014575903715,
                        "2": 0.9668937454141657,
                        "3": 0.9638007812411998,
                        "4": 0.9566939088190887
                    },
                    "delta_mae_p50": -0.017077498137950897,
                    "delta_mae_p90": -0.002456653630360961,
                    "delta_mae_p95": 0.003152842167764902,
                    "avg_latency_ms_per_text": 35.90028244443238,
                    "avg_latency_ms_per_1k_tokens": 1630.513433588471,
                    "total_time_sec": 161.5512709999457,
                    "total_tokens": 99080,
                    "price_per_1m_usd": 0.1,
                    "total_cost_usd": 0.009908,
                    "total_cost_usd_str": "0.0099"
                }
            ]
        };

        console.log('=== LEADERBOARD_DATA DEFINED ===', LEADERBOARD_DATA.results.length);

        // Global variables
        let allData = null;
        let currentPage = 1;
        const itemsPerPage = 6;
        let currentFilter = 'all';
        let currentSamples = [];
        let displayedSamples = [];

        // Load data (uses embedded LEADERBOARD_DATA constant)
        function loadData() {
            allData = LEADERBOARD_DATA;
            console.log('Data loaded successfully:', allData);
            updateStats();
            updateLeaderboard();
        }

        // Update stats
        function updateStats() {
            if (!allData) return;

            const results = allData.results;
            document.getElementById('stat-models').textContent = results.length;

            const avgKorSts = (results.reduce((sum, r) => sum + r.spearman_org_vs_score, 0) / results.length).toFixed(3);
            document.getElementById('stat-kor-sts').textContent = avgKorSts;

            const avgCmSts = (results.reduce((sum, r) => sum + r.spearman_cm_vs_score, 0) / results.length).toFixed(3);
            document.getElementById('stat-cm-sts').textContent = avgCmSts;

            // Update evaluation date
            if (allData.dataset_info?.evaluated_at) {
                const date = new Date(allData.dataset_info.evaluated_at);
                const formattedDate = date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                document.getElementById('eval-date').textContent = `Last evaluated: ${formattedDate}`;
            }
        }

        // Update leaderboard
        function updateLeaderboard() {
            if (!allData || !allData.results) {
                console.error('updateLeaderboard: No data available');
                return;
            }

            const tbody = document.getElementById('leaderboardBody');
            const sortSelect = document.getElementById('sortSelect');

            if (!tbody) {
                console.error('leaderboardBody element not found');
                return;
            }
            if (!sortSelect) {
                console.error('sortSelect element not found');
                return;
            }

            const sortBy = sortSelect.value;
            console.log('Updating leaderboard, sort by:', sortBy, 'results:', allData.results.length);

            let results = [...allData.results];

            // Sort
            results.sort((a, b) => {
                switch(sortBy) {
                    case 'cm_sts': return b.spearman_cm_vs_score - a.spearman_cm_vs_score;
                    case 'kor_sts': return b.spearman_org_vs_score - a.spearman_org_vs_score;
                    case 'auc': return b.auc_weighted - a.auc_weighted;
                    case 'latency': return a.avg_latency_ms_per_text - b.avg_latency_ms_per_text;
                    case 'cost': return a.price_per_1m_usd - b.price_per_1m_usd;
                    default: return b.spearman_cm_vs_score - a.spearman_cm_vs_score;
                }
            });

            tbody.innerHTML = results.map((r, i) => `
                <tr>
                    <td style="font-weight: 600;">${i + 1}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: var(--space-2);">
                            <span class="badge badge-${r.provider}">${r.provider}</span>
                            <span style="font-weight: 500;">${r.model}</span>
                        </div>
                    </td>
                    <td class="font-mono">${r.output_dim.toLocaleString()}</td>
                    <td class="font-mono" style="font-weight: ${sortBy === 'kor_sts' ? '600' : '400'};">${r.spearman_org_vs_score.toFixed(4)}</td>
                    <td class="font-mono" style="font-weight: ${sortBy === 'cm_sts' ? '600' : '400'};">${r.spearman_cm_vs_score.toFixed(4)}</td>
                    <td class="font-mono" style="font-weight: ${sortBy === 'auc' ? '600' : '400'};">${(r.auc_weighted * 100).toFixed(2)}%</td>
                    <td class="font-mono" style="font-weight: ${sortBy === 'latency' ? '600' : '400'};">${r.avg_latency_ms_per_text.toFixed(2)}ms</td>
                    <td class="font-mono" style="font-weight: ${sortBy === 'cost' ? '600' : '400'};">$${r.price_per_1m_usd.toFixed(2)}</td>
                </tr>
            `).join('');
        }

        // Render samples
        function renderSamples(append = false) {
            console.log('renderSamples called, append:', append);
            console.log('currentSamples.length:', currentSamples.length);
            console.log('datasetSamples.length:', datasetSamples.length);

            const grid = document.getElementById('samplesGrid');
            if (!grid) {
                console.error('samplesGrid not found!');
                return;
            }

            // Use currentSamples if set, otherwise use all datasetSamples
            if (currentSamples.length === 0) {
                currentSamples = [...datasetSamples];
            }

            // Get samples from currentSamples (filtered), not from datasetSamples
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const samples = currentSamples.slice(startIndex, endIndex);
            console.log('samples to display:', samples.length);

            if (append) {
                displayedSamples = [...displayedSamples, ...samples];
            } else {
                displayedSamples = samples;
            }

            // Update counters
            const shownCount = document.getElementById('shownCount');
            const totalCount = document.getElementById('totalCount');
            if (shownCount) shownCount.textContent = displayedSamples.length;
            if (totalCount) totalCount.textContent = currentSamples.length;

            // Update load more info
            const remaining = currentSamples.length - displayedSamples.length;
            const info = document.getElementById('loadMoreInfo');
            const loadMoreBtn = document.getElementById('loadMoreBtn');

            if (info && loadMoreBtn) {
                if (remaining > 0) {
                    info.textContent = `${remaining} more samples available`;
                    loadMoreBtn.disabled = false;
                } else {
                    info.textContent = 'All samples loaded';
                    loadMoreBtn.disabled = true;
                }
            }

            // Generate HTML
            if (displayedSamples.length === 0) {
                grid.innerHTML = '<div style="padding: 2rem; text-align: center; color: #999;">No samples to display</div>';
                return;
            }

            const html = displayedSamples.map(s => `
                <div class="sample-card">
                    <div class="sample-header">
                        <span class="sample-level">${s.level} - ${s.label}</span>
                    </div>
                    <div class="sample-content">
                        <div class="sentence-group">
                            <div class="sentence-label">Sentence A (Original Korean)</div>
                            <div class="sentence-text">${s.original_a}</div>
                        </div>
                        <div class="sentence-group">
                            <div class="sentence-label">Sentence B (Original Korean)</div>
                            <div class="sentence-text">${s.original_b}</div>
                        </div>
                        <div class="sentence-group">
                            <div class="sentence-label">Sentence B (Code-Mixed)</div>
                            <div class="sentence-text">${highlightWords(s.mixed_b)}</div>
                        </div>
                    </div>
                    <div class="sample-footer">
                        <div class="footer-item">
                            <span class="footer-label">KLUE-STS Score</span>
                            <span class="footer-value">${s.klue_score.toFixed(1)}</span>
                        </div>
                        <div class="footer-item">
                            <span class="footer-label">Similarity (B vs B-mixed)</span>
                            <span class="footer-value">${(s.similarity * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                </div>
            `).join('');

            if (append) {
                grid.innerHTML += html;
            } else {
                grid.innerHTML = html;
            }

            console.log('Rendered', displayedSamples.length, 'samples');
        }

        // Highlight English words
        function highlightWords(text) {
            if (!text) return '';
            return text.replace(/[A-Za-z]+/g, match => `<span class="mixed-word">${match}</span>`);
        }

        // Tab navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                const tab = item.dataset.tab;
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                    if (panel.dataset.panel === tab) {
                        panel.classList.add('active');
                    }
                });

                // Initialize charts when Visualization tab is clicked
                if (tab === 'visualization') {
                    initializeCharts();
                }
            });
        });

        // Filter buttons
        function initFilterButtons() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    console.log('Filter clicked:', btn.dataset.filter);

                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    currentFilter = btn.dataset.filter;
                    currentPage = 1;
                    displayedSamples = [];

                    if (currentFilter === 'all') {
                        currentSamples = [...datasetSamples];
                    } else {
                        // Handle k=4+ by filtering for k=4
                        const filterValue = currentFilter.replace('+', '');
                        currentSamples = getSamplesByLevel(filterValue);
                    }

                    console.log('Filtered samples:', currentSamples.length);
                    renderSamples();
                });
            });
        }

        // Load more button
        document.getElementById('loadMoreBtn')?.addEventListener('click', () => {
            currentPage++;
            renderSamples(true);
        });

        // Search
        function initSearch() {
            let searchTimeout;
            document.getElementById('searchInput')?.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const query = e.target.value.trim();

                    if (query) {
                        currentSamples = searchSamples(query);
                    } else {
                        if (currentFilter === 'all') {
                            currentSamples = [...datasetSamples];
                        } else {
                            currentSamples = getSamplesByLevel(currentFilter);
                        }
                    }

                    currentPage = 1;
                    displayedSamples = [];
                    renderSamples();
                }, 300);
            });
        }

        // Sort change (will be registered in window.load)

        // ===== VISUALIZATION CHARTS =====
        let bubbleChartInstance = null;
        let radarChartInstances = [];
        let aucChartInstance = null;

        // Provider colors
        const providerColors = {
            'openai': '#10a37f',
            'google': '#4285f4',
            'voyage': '#8b5cf6',
            'upstage': '#f97316'
        };

        // Create bubble chart
        function createBubbleChart() {
            if (!allData || !allData.results) return;

            const ctx = document.getElementById('bubbleChart');
            if (!ctx) return;

            if (bubbleChartInstance) bubbleChartInstance.destroy();

            const sizeMetric = document.getElementById('bubbleSizeMetric')?.value || 'efficiency';
            const results = allData.results;

            const datasets = results.map(r => {
                let size = 10;
                if (sizeMetric === 'efficiency') {
                    const normCost = r.price_per_1m_usd / 0.13;
                    const normLatency = r.avg_latency_ms_per_text / 50;
                    size = Math.max(5, 30 - (normCost + normLatency) * 10);
                } else if (sizeMetric === 'cost') {
                    size = Math.max(5, 30 - (r.price_per_1m_usd / 0.13) * 20);
                } else if (sizeMetric === 'latency') {
                    size = Math.max(5, 30 - (r.avg_latency_ms_per_text / 50) * 20);
                }

                return {
                    label: `${r.provider} - ${r.model}`,
                    data: [{
                        x: r.spearman_org_vs_score,
                        y: r.spearman_cm_vs_score,
                        r: size
                    }],
                    backgroundColor: providerColors[r.provider] + 'CC',
                    borderColor: providerColors[r.provider],
                    borderWidth: 2
                };
            });

            // Axis break plugin for bubble chart
            const axisBreakPlugin = {
                id: 'axisBreak',
                afterDraw: (chart) => {
                    const ctx = chart.ctx;
                    const chartArea = chart.chartArea;

                    ctx.save();
                    ctx.strokeStyle = '#a3a3a3';
                    ctx.lineWidth = 2.5;
                    ctx.setLineDash([]);

                    // Y-axis break (long zigzag on left side)
                    const yBreakX = chartArea.left - 8;
                    const yBreakY = chartArea.bottom - 30;
                    ctx.beginPath();
                    ctx.moveTo(yBreakX - 15, yBreakY);
                    ctx.lineTo(yBreakX - 10, yBreakY + 8);
                    ctx.lineTo(yBreakX - 5, yBreakY);
                    ctx.lineTo(yBreakX, yBreakY + 8);
                    ctx.lineTo(yBreakX + 5, yBreakY);
                    ctx.lineTo(yBreakX + 10, yBreakY + 8);
                    ctx.lineTo(yBreakX + 15, yBreakY);
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(yBreakX - 15, yBreakY + 20);
                    ctx.lineTo(yBreakX - 10, yBreakY + 28);
                    ctx.lineTo(yBreakX - 5, yBreakY + 20);
                    ctx.lineTo(yBreakX, yBreakY + 28);
                    ctx.lineTo(yBreakX + 5, yBreakY + 20);
                    ctx.lineTo(yBreakX + 10, yBreakY + 28);
                    ctx.lineTo(yBreakX + 15, yBreakY + 20);
                    ctx.stroke();

                    // X-axis break (long zigzag on bottom side)
                    const xBreakX = chartArea.left + 30;
                    const xBreakY = chartArea.bottom + 8;
                    ctx.beginPath();
                    ctx.moveTo(xBreakX, xBreakY - 15);
                    ctx.lineTo(xBreakX + 8, xBreakY - 10);
                    ctx.lineTo(xBreakX, xBreakY - 5);
                    ctx.lineTo(xBreakX + 8, xBreakY);
                    ctx.lineTo(xBreakX, xBreakY + 5);
                    ctx.lineTo(xBreakX + 8, xBreakY + 10);
                    ctx.lineTo(xBreakX, xBreakY + 15);
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(xBreakX + 20, xBreakY - 15);
                    ctx.lineTo(xBreakX + 28, xBreakY - 10);
                    ctx.lineTo(xBreakX + 20, xBreakY - 5);
                    ctx.lineTo(xBreakX + 28, xBreakY);
                    ctx.lineTo(xBreakX + 20, xBreakY + 5);
                    ctx.lineTo(xBreakX + 28, xBreakY + 10);
                    ctx.lineTo(xBreakX + 20, xBreakY + 15);
                    ctx.stroke();

                    ctx.restore();
                }
            };

            bubbleChartInstance = new Chart(ctx, {
                type: 'bubble',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                font: { family: 'Inter', size: 11 },
                                color: '#525252',
                                padding: 12,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: '#ffffff',
                            titleColor: '#0f0f0f',
                            bodyColor: '#525252',
                            borderColor: '#e5e5e5',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: (context) => {
                                    const r = results[context.datasetIndex];
                                    const costStr = r.price_per_1m_usd ? `$${r.price_per_1m_usd}/1M` : 'N/A';
                                    const latencyStr = r.avg_latency_ms_per_text?.toFixed(2) || 'N/A';
                                    return [
                                        `Model: ${r.model}`,
                                        `KOR-STS: ${r.spearman_org_vs_score.toFixed(4)}`,
                                        `CM-STS: ${r.spearman_cm_vs_score.toFixed(4)}`,
                                        `AUC: ${(r.auc_weighted * 100).toFixed(2)}%`,
                                        `Cost: ${costStr}`,
                                        `Latency: ${latencyStr}ms/text`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            min: 0.85,
                            max: 0.95,
                            title: {
                                display: true,
                                text: 'Korean STS (Spearman)',
                                font: { family: 'Inter', size: 12, weight: '500' },
                                color: '#525252'
                            },
                            ticks: {
                                font: { family: 'JetBrains Mono', size: 10 },
                                color: '#a3a3a3'
                            },
                            grid: {
                                color: '#f5f5f5',
                                drawBorder: false
                            }
                        },
                        y: {
                            min: 0.85,
                            max: 0.95,
                            title: {
                                display: true,
                                text: 'Code-Mixed STS (Spearman)',
                                font: { family: 'Inter', size: 12, weight: '500' },
                                color: '#525252'
                            },
                            ticks: {
                                font: { family: 'JetBrains Mono', size: 10 },
                                color: '#a3a3a3'
                            },
                            grid: {
                                color: '#f5f5f5',
                                drawBorder: false
                            }
                        }
                    }
                },
                plugins: [axisBreakPlugin]
            });
        }

        // Create radar charts (matching cm-sts-leaderboard.html)
        function createRadarCharts() {
            if (!allData || !allData.results) return;

            const results = allData.results;

            // Normalization helpers (same as cm-sts-leaderboard.html)
            function normalizeWithRange(values, minRange, maxRange) {
                return values.map(v => {
                    if (!Number.isFinite(v)) return 0;
                    const clamped = Math.max(minRange, Math.min(maxRange, v));
                    const t = (clamped - minRange) / (maxRange - minRange);
                    return t;
                });
            }

            // Normalize scores with predefined ranges
            const korSTS = normalizeWithRange(results.map(m => m.spearman_org_vs_score), 0.7, 1.0);
            const cmSTS = normalizeWithRange(results.map(m => m.spearman_cm_vs_score), 0.7, 1.0);
            const robust = normalizeWithRange(results.map(m => m.auc_weighted), 0.95, 1.0);

            // Cost and latency efficiency
            const costScores = results.map(m => {
                const price = m.price_per_1m_usd || 0.15;
                return Math.max(0, Math.min(1, (0.25 - price) / (0.25 - 0.05)));
            });
            const latencyScores = results.map(m => {
                const lat = m.avg_latency_ms_per_text || 30;
                return Math.max(0, Math.min(1, (50 - lat) / (50 - 10)));
            });

            results.forEach((r, idx) => {
                const ctx = document.getElementById(`radarChart${idx}`);
                if (!ctx) return;

                // Update titles
                document.getElementById(`radar-title-${idx}`).textContent = r.provider.toUpperCase();
                document.getElementById(`radar-subtitle-${idx}`).textContent = r.model;

                if (radarChartInstances[idx]) radarChartInstances[idx].destroy();

                radarChartInstances[idx] = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['KOR STS', 'CM STS', 'Robustness', 'Cost Eff.', 'Latency Eff.'],
                        datasets: [{
                            label: r.model,
                            data: [
                                (korSTS[idx] * 100).toFixed(0),
                                (cmSTS[idx] * 100).toFixed(0),
                                (robust[idx] * 100).toFixed(0),
                                (costScores[idx] * 100).toFixed(0),
                                (latencyScores[idx] * 100).toFixed(0)
                            ],
                            backgroundColor: providerColors[r.provider] + '33',
                            borderColor: providerColors[r.provider],
                            borderWidth: 2,
                            pointBackgroundColor: providerColors[r.provider],
                            pointBorderColor: '#fff',
                            pointBorderWidth: 1,
                            pointRadius: 3,
                            pointHoverRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: '#ffffff',
                                titleColor: '#0f0f0f',
                                bodyColor: '#525252',
                                borderColor: '#e5e5e5',
                                borderWidth: 1,
                                padding: 12,
                                callbacks: {
                                    label: (ctx) => {
                                        const idx = ctx.dataIndex;
                                        const normalizedScore = ctx.parsed.r;

                                        if (idx === 0) {
                                            return [
                                                `KOR STS (Spearman)`,
                                                `  Raw: ${r.spearman_org_vs_score?.toFixed(4) || 'N/A'}`,
                                                `  Normalized: ${normalizedScore}`
                                            ];
                                        } else if (idx === 1) {
                                            return [
                                                `CM STS (Spearman)`,
                                                `  Raw: ${r.spearman_cm_vs_score?.toFixed(4) || 'N/A'}`,
                                                `  Normalized: ${normalizedScore}`
                                            ];
                                        } else if (idx === 2) {
                                            return [
                                                `Robustness (AUC)`,
                                                `  Raw: ${r.auc_weighted?.toFixed(4) || 'N/A'}`,
                                                `  Normalized: ${normalizedScore}`
                                            ];
                                        } else if (idx === 3) {
                                            return [
                                                `Cost Efficiency`,
                                                `  Price: $${r.price_per_1m_usd || 'N/A'}/1M`,
                                                `  Score: ${normalizedScore}`
                                            ];
                                        } else if (idx === 4) {
                                            return [
                                                `Latency Efficiency`,
                                                `  Latency: ${r.avg_latency_ms_per_text?.toFixed(2) || 'N/A'}ms`,
                                                `  Score: ${normalizedScore}`
                                            ];
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            r: {
                                min: 0,
                                max: 100,
                                ticks: {
                                    stepSize: 20,
                                    font: { family: 'JetBrains Mono', size: 9 },
                                    color: '#a3a3a3',
                                    backdropColor: 'transparent',
                                    showLabelBackdrop: false
                                },
                                pointLabels: {
                                    font: { family: 'Inter', size: 10, weight: '500' },
                                    color: '#525252'
                                },
                                grid: {
                                    color: '#f5f5f5',
                                    circular: true
                                },
                                angleLines: {
                                    color: '#f5f5f5'
                                }
                            }
                        }
                    }
                });
            });
        }

        // Create AUC chart
        function createAUCChart() {
            if (!allData || !allData.results) return;

            const ctx = document.getElementById('aucChart');
            if (!ctx) return;

            if (aucChartInstance) aucChartInstance.destroy();

            const results = allData.results;

            // Sort by AUC weighted (descending)
            const sorted = [...results].sort((a, b) => (b.auc_weighted || 0) - (a.auc_weighted || 0));

            const datasets = sorted.map(r => {
                // Use retention_by_k data for k=1,2,3,4
                const retention = r.retention_by_k || {};
                const arr = [1, 2, 3, 4].map(k => {
                    const val = retention[String(k)] ?? retention[k];
                    return val ?? 1.0;
                });

                return {
                    label: `${r.provider}/${r.model} ¬∑ AUC=${(r.auc_weighted || 0).toFixed(4)}`,
                    data: arr,
                    borderColor: providerColors[r.provider],
                    backgroundColor: providerColors[r.provider] + '20',
                    borderWidth: 2.5,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    pointBackgroundColor: providerColors[r.provider],
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    cubicInterpolationMode: 'monotone'
                };
            });

            // Axis break plugin for AUC chart
            const aucAxisBreakPlugin = {
                id: 'aucAxisBreak',
                afterDraw: (chart) => {
                    const ctx = chart.ctx;
                    const chartArea = chart.chartArea;

                    ctx.save();
                    ctx.strokeStyle = '#a3a3a3';
                    ctx.lineWidth = 2.5;
                    ctx.setLineDash([]);

                    // Y-axis break (long zigzag on left side)
                    const yBreakX = chartArea.left - 8;
                    const yBreakY = chartArea.bottom - 30;
                    ctx.beginPath();
                    ctx.moveTo(yBreakX - 15, yBreakY);
                    ctx.lineTo(yBreakX - 10, yBreakY + 8);
                    ctx.lineTo(yBreakX - 5, yBreakY);
                    ctx.lineTo(yBreakX, yBreakY + 8);
                    ctx.lineTo(yBreakX + 5, yBreakY);
                    ctx.lineTo(yBreakX + 10, yBreakY + 8);
                    ctx.lineTo(yBreakX + 15, yBreakY);
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(yBreakX - 15, yBreakY + 20);
                    ctx.lineTo(yBreakX - 10, yBreakY + 28);
                    ctx.lineTo(yBreakX - 5, yBreakY + 20);
                    ctx.lineTo(yBreakX, yBreakY + 28);
                    ctx.lineTo(yBreakX + 5, yBreakY + 20);
                    ctx.lineTo(yBreakX + 10, yBreakY + 28);
                    ctx.lineTo(yBreakX + 15, yBreakY + 20);
                    ctx.stroke();

                    ctx.restore();
                }
            };

            aucChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['k=1', 'k=2', 'k=3', 'k=4'],
                    datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                font: { family: 'Inter', size: 11 },
                                color: '#525252',
                                padding: 12,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: '#ffffff',
                            titleColor: '#0f0f0f',
                            bodyColor: '#525252',
                            borderColor: '#e5e5e5',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: (ctx) => {
                                    const label = ctx.dataset.label.split(' ¬∑ ')[0];
                                    const val = ctx.parsed.y;
                                    return `${label}: ${(val * 100).toFixed(2)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Code-Mixing Level (k)',
                                font: { family: 'Inter', size: 12, weight: '500' },
                                color: '#525252'
                            },
                            ticks: {
                                font: { family: 'Inter', size: 11 },
                                color: '#525252'
                            },
                            grid: {
                                color: '#f5f5f5',
                                drawBorder: false
                            }
                        },
                        y: {
                            min: 0.90,
                            max: 1.0,
                            title: {
                                display: true,
                                text: 'Performance Retention',
                                font: { family: 'Inter', size: 12, weight: '500' },
                                color: '#525252'
                            },
                            ticks: {
                                callback: (v) => (v * 100).toFixed(1) + '%',
                                font: { family: 'JetBrains Mono', size: 10 },
                                color: '#a3a3a3'
                            },
                            grid: {
                                color: '#f5f5f5',
                                drawBorder: false
                            }
                        }
                    }
                },
                plugins: [aucAxisBreakPlugin]
            });
        }

        // Update charts when controls change
        document.getElementById('bubbleSizeMetric')?.addEventListener('change', createBubbleChart);

        // Initialize charts function
        let chartsInitialized = false;
        function initializeCharts() {
            if (allData && allData.results && !chartsInitialized) {
                createBubbleChart();
                createRadarCharts();
                createAUCChart();
                chartsInitialized = true;
            }
        }

        // Initialize
        window.addEventListener('load', async () => {
            console.log('=== PAGE LOAD START ===');
            console.log('LEADERBOARD_DATA available:', typeof LEADERBOARD_DATA, LEADERBOARD_DATA?.results?.length);
            console.log('loadSamplesData function:', typeof loadSamplesData);

            // Load leaderboard data
            loadData();

            // Load dataset samples
            try {
                console.log('Loading dataset samples...');
                const samples = await loadSamplesData();
                console.log('loadSamplesData returned:', samples?.length, 'samples');
                console.log('datasetSamples global array:', datasetSamples.length);

                // Initialize currentSamples
                currentSamples = [...datasetSamples];
                console.log('currentSamples initialized:', currentSamples.length);

                // Render samples after loading
                if (datasetSamples.length > 0) {
                    console.log('Calling renderSamples...');
                    renderSamples();

                    // Initialize filter buttons and search after samples are loaded
                    console.log('Initializing filter buttons...');
                    initFilterButtons();

                    console.log('Initializing search...');
                    initSearch();

                    console.log('=== INITIALIZATION COMPLETE ===');
                } else {
                    console.error('Failed to load dataset samples! datasetSamples.length:', datasetSamples.length);
                }
            } catch (error) {
                console.error('Error during initialization:', error);
            }

            // Register sort change listener
            const sortSelect = document.getElementById('sortSelect');
            console.log('sortSelect element:', sortSelect);
            if (sortSelect) {
                sortSelect.addEventListener('change', updateLeaderboard);
            }
        });
    </script>
</body>
</html>